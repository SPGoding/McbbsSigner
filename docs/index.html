<html>
<title>AutoSigner</title>

<body>
    <canvas id="myCanvas" width="285" height="267" style="border:1px solid #d3d3d3;">你的垃圾浏览器无法正确处理canvas元素</canvas>
    <img id="myImage" src="bg.jpg" width="0" height="0" crossOrigin="anonymous">
    <br>

    <a target="_blank" href="http://www.mcbbs.net/home.php?mod=task&do=draw&id=10">每日红包</a>
    <br>
    <a target="_blank" href="http://www.mcbbs.net/home.php?mod=task&do=apply&id=24">申请任务</a>
    <br>
    <a target="_blank" href="http://sm.ms">图床</a>
    <br>
    <a target="_blank" href="http://www.mcbbs.net/thread-69533-1-1.html">回帖</a>
    <br>
    <a target="_blank" href="http://www.mcbbs.net/home.php?mod=task&do=draw&id=24">领取奖励</a>
    <br>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        /*
         * 格式化Date
         */
        Date.prototype.format = function (fmt) {
            let o = {
                'M+': this.getMonth() + 1, //月份 
                'd+': this.getDate(), //日 
                'h+': this.getHours(), //小时 
                'm+': this.getMinutes(), //分 
                's+': this.getSeconds(), //秒 
                'q+': Math.floor((this.getMonth() + 3) / 3), //季度 
                'S': this.getMilliseconds() //毫秒 
            }
            if (/(y+)/.test(fmt)) {
                fmt = fmt.replace(RegExp.$1, (this.getFullYear() + '').substr(4 - RegExp.$1.length));
            }
            for (let k in o) {
                if (new RegExp('(' + k + ')').test(fmt)) {
                    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length)))
                }
            }
            return fmt
        }


        /*
         * 将dataURL转换为File
         */
        function dataURLtoFile(dataurl, filename) {
            let arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1]
            let bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n)
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n)
            }
            return new File([u8arr], filename, { type: mime })
        }

        /*
         * 绘制canvas
         */
        $(document).ready(function () {
            let now = new Date()
            let c = document.getElementById('myCanvas')
            let img = document.getElementById('myImage')
            let context = c.getContext('2d')

            now = now.format('MM.dd.yyyy')

            context.drawImage(img, 0, 0, 285, 267)
            context.font = '48px 微软雅黑'
            context.fillText(now, 0, 48)
        })

        // /*
        //  * POST图片文件并取得链接
        //  */
        // $('#post').click(function () {
        //     let c = document.getElementById('myCanvas')

        //     let url = c.toDataURL('image/png')
        //     let file = dataURLtoFile(url, 'signImage.png')

        //     xmlHttp = new XMLHttpRequest()
        //     xmlHttp.onreadystatechange = function () {
        //         if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
        //             let json = eval('(' + xmlHttp.responseText + ')')
        //             if (json.code == 'success') {
        //                 alert(json.data.url)
        //             } else {
        //                 alert('上传失败: ' + json.msg)
        //             }
        //         }
        //     }
        //     xmlHttp.open('POST', 'https://sm.ms/api/upload', true)
        //     xmlHttp.send('smfile=' + file + '&ssl=true&format=json')
        // })
    </script>
</body>

</html>